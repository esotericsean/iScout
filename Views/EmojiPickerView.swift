import SwiftUI

struct EmojiPickerView: View {
    @Environment(\.dismiss) var dismiss
    @Binding var selectedEmoji: String
    @State private var searchText = ""
    
    // Category order
    let categoryOrder = [
        "Frequently Used",
        "Places",
        "Nature",
        "Animals",
        "Birds & Sea Life",
        "Food & Drink",
        "Activities",
        "Transportation",
        "Weather",
        "Faces",
        "Symbols",
        "Flags"
    ]
    
    // Categories of emojis
    let categories = [
        "Frequently Used": ["ðŸ“", "â­ï¸", "ðŸ ", "ðŸŽ¯", "â¤ï¸", "ðŸŒŸ", "ðŸŽª", "ðŸ›", "ðŸ•", "ðŸ˜Š"],
        "Places": [
            "ðŸ ", "ðŸ¡", "ðŸ¢", "ðŸ£", "ðŸ¤", "ðŸ¥", "ðŸ¦", "ðŸ¨", "ðŸ©", "ðŸª", "ðŸ«", "ðŸ¬", "ðŸ­", "ðŸ¯", "ðŸ°",
            "ðŸ’’", "â›ªï¸", "ðŸ•Œ", "ðŸ•", "â›©ï¸", "ðŸ•‹", "â›²ï¸", "â›ºï¸", "ðŸ›", "ðŸ—", "ðŸ˜", "ðŸš", "ðŸ•", "ðŸœ", "ðŸ",
            "ðŸŸ", "ðŸž", "ðŸ–", "ðŸ¥", "ðŸ¤", "ðŸ£", "ðŸ¬", "ðŸª", "ðŸ«", "ðŸ—½", "ðŸ—¿", "ðŸ—¼", "ðŸŽª", "ðŸŽ­", "ðŸŽ¢"
        ],
        "Nature": [
            "ðŸŒ²", "ðŸŒ³", "ðŸŒ´", "ðŸŒµ", "ðŸŒ·", "ðŸŒ¸", "ðŸŒ¹", "ðŸŒº", "ðŸŒ»", "ðŸŒ¼", "ðŸ€", "ðŸŒ¿", "â˜˜ï¸", "ðŸ‚", "ðŸ",
            "ðŸŒ¾", "ðŸŒ±", "ðŸŽ‹", "ðŸŽ", "ðŸƒ", "ðŸŒŠ", "ðŸ”", "â›°", "ðŸ—»", "ðŸŒ‹", "ðŸž", "ðŸ–", "ðŸ•", "ðŸŒ…", "ðŸŒ„",
            "ðŸŒŽ", "ðŸŒ", "ðŸŒ", "ðŸŒ‘", "ðŸŒ’", "ðŸŒ“", "ðŸŒ”", "ðŸŒ•", "ðŸŒ–", "ðŸŒ—", "ðŸŒ˜", "ðŸŒ™", "ðŸŒš", "ðŸŒ›", "ðŸŒœ"
        ],
        "Animals": [
            "ðŸ¶", "ðŸ•", "ðŸ¦®", "ðŸ•â€ðŸ¦º", "ðŸ©", "ðŸ±", "ðŸˆ", "ðŸˆâ€â¬›", "ðŸ¦", "ðŸ¯", "ðŸ…", "ðŸ†", "ðŸ´", "ðŸŽ", "ðŸ¦„",
            "ðŸ¦“", "ðŸ¦Œ", "ðŸ®", "ðŸ‚", "ðŸƒ", "ðŸ„", "ðŸ·", "ðŸ–", "ðŸ—", "ðŸ", "ðŸ‘", "ðŸ", "ðŸª", "ðŸ«", "ðŸ¦™",
            "ðŸ¦˜", "ðŸ¦¥", "ðŸ¦¨", "ðŸ¦¡", "ðŸ˜", "ðŸ¦", "ðŸ¦›", "ðŸ­", "ðŸ", "ðŸ€", "ðŸ¹", "ðŸ°", "ðŸ‡", "ðŸ¿", "ðŸ¦«"
        ],
        "Birds & Sea Life": [
            "ðŸ¦…", "ðŸ¦†", "ðŸ¦¢", "ðŸ¦‰", "ðŸ¦¤", "ðŸª¶", "ðŸ¦©", "ðŸ¦š", "ðŸ¦œ", "ðŸ¸", "ðŸŠ", "ðŸ¢", "ðŸ¦Ž", "ðŸ", "ðŸ³",
            "ðŸ‹", "ðŸ¬", "ðŸ¦ˆ", "ðŸŸ", "ðŸ ", "ðŸ¡", "ðŸ¦", "ðŸ¦‘", "ðŸ™", "ðŸ¦ž", "ðŸ¦€", "ðŸš", "ðŸ¦†", "ðŸ¦…", "ðŸ¦‰"
        ],
        "Food & Drink": [
            "ðŸ•", "ðŸ”", "ðŸŸ", "ðŸŒ­", "ðŸ¥ª", "ðŸŒ®", "ðŸŒ¯", "ðŸ¥™", "ðŸ³", "ðŸ¥˜", "ðŸ²", "ðŸ¥£", "ðŸ¥—", "ðŸ¿", "ðŸ§‚",
            "â˜•ï¸", "ðŸµ", "ðŸ§ƒ", "ðŸ¥¤", "ðŸ§‹", "ðŸ¶", "ðŸº", "ðŸ»", "ðŸ¥‚", "ðŸ·", "ðŸ¥ƒ", "ðŸ¸", "ðŸ¹", "ðŸ©", "ðŸ¦",
            "ðŸ°", "ðŸ§", "ðŸ¥§", "ðŸª", "ðŸ«", "ðŸ¬", "ðŸ­", "ðŸ¡", "ðŸ§", "ðŸ¨", "ðŸ¯", "ðŸ¥œ", "ðŸŒ°", "ðŸ–", "ðŸ¥©"
        ],
        "Activities": [
            "âš½ï¸", "ðŸ€", "ðŸˆ", "âš¾ï¸", "ðŸ¥Ž", "ðŸŽ¾", "ðŸ", "ðŸ‰", "ðŸ¥", "ðŸŽ±", "ðŸ“", "ðŸ¸", "ðŸ’", "ðŸ‘", "ðŸ¥",
            "ðŸŽ£", "ðŸ¥Š", "ðŸŽ­", "ðŸŽ¨", "ðŸŽ¬", "ðŸŽ¤", "ðŸŽ®", "ðŸŽ²", "ðŸŽ°", "ðŸ›", "ðŸŽª", "ðŸŽ¢", "ðŸŽ¡", "â›³ï¸", "ðŸŽ¯",
            "ðŸŽ¹", "ðŸŽ¸", "ðŸŽº", "ðŸŽ·", "ðŸ¥", "ðŸŽ»", "ðŸª—", "ðŸŽ¼", "ðŸŽ§", "ðŸŽ¤", "ðŸŽ­", "ðŸŽª", "ðŸŽ¨", "ðŸŽ¯", "ðŸŽ±"
        ],
        "Transportation": [
            "âœˆï¸", "ðŸ›©", "ðŸš", "ðŸš‚", "ðŸšŠ", "ðŸš‰", "ðŸš†", "ðŸš‡", "ðŸš", "ðŸš…", "ðŸš„", "ðŸšˆ", "ðŸšž", "ðŸš‹", "ðŸšƒ",
            "ðŸš—", "ðŸš•", "ðŸš™", "ðŸšŒ", "ðŸšŽ", "ðŸŽ", "ðŸš“", "ðŸš‘", "ðŸš’", "ðŸ›»", "ðŸšš", "ðŸ›µ", "ðŸ", "ðŸš²", "â›´",
            "ðŸš¢", "ðŸ›¥", "ðŸ›³", "â›´", "ðŸš¤", "ðŸ›¶", "ðŸš", "ðŸ›¸", "ðŸš€", "ðŸ›°", "ðŸš¡", "ðŸš ", "ðŸšŸ", "ðŸšƒ", "ðŸš‚"
        ],
        "Weather": [
            "â˜€ï¸", "ðŸŒ¤", "â›…ï¸", "ðŸŒ¥", "â˜ï¸", "ðŸŒ¦", "ðŸŒ§", "â›ˆ", "ðŸŒ©", "ðŸŒ¨", "â„ï¸", "â˜ƒï¸", "â›„ï¸", "ðŸŒ¬", "ðŸ’¨",
            "ðŸŒª", "ðŸŒ«", "ðŸŒŠ", "ðŸ’§", "ðŸ’¦", "â˜”ï¸", "âš¡ï¸", "â„ï¸", "ðŸŒˆ", "â˜€ï¸", "ðŸŒ™", "â­ï¸", "ðŸŒŸ", "âœ¨", "âš¡ï¸"
        ],
        "Faces": [
            "ðŸ˜€", "ðŸ˜ƒ", "ðŸ˜„", "ðŸ˜", "ðŸ˜†", "ðŸ˜…", "ðŸ˜‚", "ðŸ¤£", "ðŸ¥²", "â˜ºï¸", "ðŸ˜Š", "ðŸ˜‡", "ðŸ™‚", "ðŸ™ƒ", "ðŸ˜‰",
            "ðŸ˜Œ", "ðŸ˜", "ðŸ¥°", "ðŸ˜˜", "ðŸ˜—", "ðŸ˜™", "ðŸ˜š", "ðŸ˜‹", "ðŸ˜›", "ðŸ˜", "ðŸ˜œ", "ðŸ¤ª", "ðŸ¤¨", "ðŸ§", "ðŸ¤“"
        ],
        "Symbols": [
            "â¤ï¸", "ðŸ§¡", "ðŸ’›", "ðŸ’š", "ðŸ’™", "ðŸ’œ", "ðŸ¤Ž", "ðŸ–¤", "ðŸ¤", "ðŸ’”", "â£ï¸", "ðŸ’•", "ðŸ’ž", "ðŸ’“", "ðŸ’—",
            "â­ï¸", "ðŸŒŸ", "âœ¨", "ðŸ’«", "â˜€ï¸", "ðŸŒˆ", "â˜˜ï¸", "ðŸ€", "ðŸŽ¯", "ðŸ”†", "âœ…", "â˜‘ï¸", "âœ”ï¸", "ðŸ“", "ðŸ“Œ",
            "ðŸ’¯", "â—ï¸", "â“", "â€¼ï¸", "â‰ï¸", "ðŸ”°", "âœ³ï¸", "â‡ï¸", "Â©ï¸", "Â®ï¸", "â„¢ï¸", "âž¡ï¸", "â¬…ï¸", "â¬†ï¸", "â¬‡ï¸"
        ],
        "Flags": [
            // Special flags
            "ðŸ", "ðŸš©", "ðŸŽŒ", "ðŸ´", "ðŸ³ï¸", "ðŸ³ï¸â€ðŸŒˆ", "ðŸ³ï¸â€âš§ï¸", "ðŸ´â€â˜ ï¸",
            // Country flags (alphabetical order)
            "ðŸ‡¦ðŸ‡¨", "ðŸ‡¦ðŸ‡©", "ðŸ‡¦ðŸ‡ª", "ðŸ‡¦ðŸ‡«", "ðŸ‡¦ðŸ‡¬", "ðŸ‡¦ðŸ‡®", "ðŸ‡¦ðŸ‡±", "ðŸ‡¦ðŸ‡²", "ðŸ‡¦ðŸ‡´", "ðŸ‡¦ðŸ‡¶", "ðŸ‡¦ðŸ‡·", "ðŸ‡¦ðŸ‡¸", "ðŸ‡¦ðŸ‡¹", "ðŸ‡¦ðŸ‡º", "ðŸ‡¦ðŸ‡½", "ðŸ‡¦ðŸ‡¿",
            "ðŸ‡§ðŸ‡¦", "ðŸ‡§ðŸ‡§", "ðŸ‡§ðŸ‡©", "ðŸ‡§ðŸ‡ª", "ðŸ‡§ðŸ‡«", "ðŸ‡§ðŸ‡¬", "ðŸ‡§ðŸ‡­", "ðŸ‡§ðŸ‡®", "ðŸ‡§ðŸ‡¯", "ðŸ‡§ðŸ‡±", "ðŸ‡§ðŸ‡²", "ðŸ‡§ðŸ‡³", "ðŸ‡§ðŸ‡´", "ðŸ‡§ðŸ‡¶", "ðŸ‡§ðŸ‡·", "ðŸ‡§ðŸ‡¸", "ðŸ‡§ðŸ‡¹", "ðŸ‡§ðŸ‡»", "ðŸ‡§ðŸ‡¼", "ðŸ‡§ðŸ‡¾", "ðŸ‡§ðŸ‡¿",
            "ðŸ‡¨ðŸ‡¦", "ðŸ‡¨ðŸ‡¨", "ðŸ‡¨ðŸ‡©", "ðŸ‡¨ðŸ‡«", "ðŸ‡¨ðŸ‡¬", "ðŸ‡¨ðŸ‡­", "ðŸ‡¨ðŸ‡®", "ðŸ‡¨ðŸ‡°", "ðŸ‡¨ðŸ‡±", "ðŸ‡¨ðŸ‡²", "ðŸ‡¨ðŸ‡³", "ðŸ‡¨ðŸ‡´", "ðŸ‡¨ðŸ‡µ", "ðŸ‡¨ðŸ‡·", "ðŸ‡¨ðŸ‡º", "ðŸ‡¨ðŸ‡»", "ðŸ‡¨ðŸ‡¼", "ðŸ‡¨ðŸ‡½", "ðŸ‡¨ðŸ‡¾", "ðŸ‡¨ðŸ‡¿",
            "ðŸ‡©ðŸ‡ª", "ðŸ‡©ðŸ‡¬", "ðŸ‡©ðŸ‡¯", "ðŸ‡©ðŸ‡°", "ðŸ‡©ðŸ‡°", "ðŸ‡©ðŸ‡´", "ðŸ‡©ðŸ‡¿",
            "ðŸ‡ªðŸ‡¦", "ðŸ‡ªðŸ‡¨", "ðŸ‡ªðŸ‡ª", "ðŸ‡ªðŸ‡¬", "ðŸ‡ªðŸ‡­", "ðŸ‡ªðŸ‡·", "ðŸ‡ªðŸ‡¹",
            "ðŸ‡«ðŸ‡®", "ðŸ‡«ðŸ‡¯", "ðŸ‡«ðŸ‡°", "ðŸ‡«ðŸ‡°", "ðŸ‡«ðŸ‡´", "ðŸ‡«ðŸ‡·",
            "ðŸ‡¬ðŸ‡¦", "ðŸ‡¬ðŸ‡§", "ðŸ‡¬ðŸ‡©", "ðŸ‡¬ðŸ‡ª", "ðŸ‡¬ðŸ‡«", "ðŸ‡¬ðŸ‡¬", "ðŸ‡¬ðŸ‡­", "ðŸ‡¬ðŸ‡®", "ðŸ‡¬ðŸ‡±", "ðŸ‡¬ðŸ‡²", "ðŸ‡¬ðŸ‡³", "ðŸ‡¬ðŸ‡µ", "ðŸ‡¬ðŸ‡¶", "ðŸ‡¬ðŸ‡·", "ðŸ‡¬ðŸ‡¸", "ðŸ‡¬ðŸ‡¹", "ðŸ‡¬ðŸ‡¹", "ðŸ‡¬ðŸ‡¼", "ðŸ‡¬ðŸ‡¾",
            "ðŸ‡­ðŸ‡°", "ðŸ‡­ðŸ‡²", "ðŸ‡­ðŸ‡³", "ðŸ‡­ðŸ‡³", "ðŸ‡­ðŸ‡¹", "ðŸ‡­ðŸ‡º",
            "ðŸ‡®ðŸ‡¨", "ðŸ‡®ðŸ‡©", "ðŸ‡®ðŸ‡ª", "ðŸ‡®ðŸ‡±", "ðŸ‡®ðŸ‡²", "ðŸ‡®ðŸ‡³", "ðŸ‡®ðŸ‡´", "ðŸ‡®ðŸ‡¶", "ðŸ‡®ðŸ‡·", "ðŸ‡®ðŸ‡¸", "ðŸ‡®ðŸ‡¹",
            "ðŸ‡¯ðŸ‡ª", "ðŸ‡¯ðŸ‡ª", "ðŸ‡¯ðŸ‡´", "ðŸ‡¯ðŸ‡µ",
            "ðŸ‡°ðŸ‡ª", "ðŸ‡°ðŸ‡¬", "ðŸ‡°ðŸ‡­", "ðŸ‡°ðŸ‡®", "ðŸ‡°ðŸ‡²", "ðŸ‡°ðŸ‡³", "ðŸ‡°ðŸ‡µ", "ðŸ‡°ðŸ‡·", "ðŸ‡°ðŸ‡¼", "ðŸ‡°ðŸ‡¾", "ðŸ‡°ðŸ‡¿",
            "ðŸ‡±ðŸ‡¦", "ðŸ‡±ðŸ‡§", "ðŸ‡±ðŸ‡¨", "ðŸ‡±ðŸ‡®", "ðŸ‡±ðŸ‡°", "ðŸ‡±ðŸ‡·", "ðŸ‡±ðŸ‡¸", "ðŸ‡±ðŸ‡¹", "ðŸ‡±ðŸ‡»", "ðŸ‡±ðŸ‡¾",
            "ðŸ‡²ðŸ‡¦", "ðŸ‡²ðŸ‡¨", "ðŸ‡²ðŸ‡©", "ðŸ‡²ðŸ‡ª", "ðŸ‡²ðŸ‡«", "ðŸ‡²ðŸ‡¬", "ðŸ‡²ðŸ‡­", "ðŸ‡²ðŸ‡°", "ðŸ‡²ðŸ‡±", "ðŸ‡²ðŸ‡²", "ðŸ‡²ðŸ‡³", "ðŸ‡²ðŸ‡´", "ðŸ‡²ðŸ‡µ", "ðŸ‡²ðŸ‡¶", "ðŸ‡²ðŸ‡·", "ðŸ‡²ðŸ‡¸", "ðŸ‡²ðŸ‡¹", "ðŸ‡²ðŸ‡º", "ðŸ‡²ðŸ‡»", "ðŸ‡²ðŸ‡¼", "ðŸ‡²ðŸ‡¾", "ðŸ‡²ðŸ‡¿",
            "ðŸ‡³ðŸ‡¦", "ðŸ‡³ðŸ‡¨", "ðŸ‡³ðŸ‡ª", "ðŸ‡³ðŸ‡«", "ðŸ‡³ðŸ‡¬", "ðŸ‡³ðŸ‡®", "ðŸ‡³ðŸ‡±", "ðŸ‡³ðŸ‡´", "ðŸ‡³ðŸ‡µ", "ðŸ‡³ðŸ‡µ", "ðŸ‡³ðŸ‡º", "ðŸ‡³ðŸ‡¿",
            "ðŸ‡´ðŸ‡²",
            "ðŸ‡µðŸ‡¦", "ðŸ‡µðŸ‡ª", "ðŸ‡µðŸ‡«", "ðŸ‡µðŸ‡¬", "ðŸ‡µðŸ‡­", "ðŸ‡µðŸ‡°", "ðŸ‡µðŸ‡±", "ðŸ‡µðŸ‡²", "ðŸ‡µðŸ‡³", "ðŸ‡µðŸ‡·", "ðŸ‡µðŸ‡¸", "ðŸ‡µðŸ‡¸", "ðŸ‡µðŸ‡¼", "ðŸ‡µðŸ‡¾",
            "ðŸ‡¶ðŸ‡¦",
            "ðŸ‡·ðŸ‡ª", "ðŸ‡·ðŸ‡´", "ðŸ‡·ðŸ‡º", "ðŸ‡·ðŸ‡¼",
            "ðŸ‡¸ðŸ‡¦", "ðŸ‡¸ðŸ‡§", "ðŸ‡¸ðŸ‡¨", "ðŸ‡¸ðŸ‡©", "ðŸ‡¸ðŸ‡ª", "ðŸ‡¸ðŸ‡¬", "ðŸ‡¸ðŸ‡­", "ðŸ‡¸ðŸ‡®", "ðŸ‡¸ðŸ‡¯", "ðŸ‡¸ðŸ‡°", "ðŸ‡¸ðŸ‡±", "ðŸ‡¸ðŸ‡²", "ðŸ‡¸ðŸ‡³", "ðŸ‡¸ðŸ‡´", "ðŸ‡¸ðŸ‡·", "ðŸ‡¸ðŸ‡¸", "ðŸ‡¸ðŸ‡¹", "ðŸ‡¸ðŸ‡»", "ðŸ‡¸ðŸ‡¾", "ðŸ‡¸ðŸ‡¿",
            "ðŸ‡¹ðŸ‡¦", "ðŸ‡¹ðŸ‡¨", "ðŸ‡¹ðŸ‡©", "ðŸ‡¹ðŸ‡«", "ðŸ‡¹ðŸ‡¬", "ðŸ‡¹ðŸ‡­", "ðŸ‡¹ðŸ‡¯", "ðŸ‡¹ðŸ‡°", "ðŸ‡¹ðŸ‡±", "ðŸ‡¹ðŸ‡²", "ðŸ‡¹ðŸ‡³", "ðŸ‡¹ðŸ‡´", "ðŸ‡¹ðŸ‡·", "ðŸ‡¹ðŸ‡¹", "ðŸ‡¹ðŸ‡»", "ðŸ‡¹ðŸ‡¼", "ðŸ‡¹ðŸ‡¿",
            "ðŸ‡ºðŸ‡¦", "ðŸ‡ºðŸ‡¬", "ðŸ‡ºðŸ‡²", "ðŸ‡ºðŸ‡³", "ðŸ‡ºðŸ‡³", "ðŸ‡ºðŸ‡¾", "ðŸ‡ºðŸ‡¿",
            "ðŸ‡»ðŸ‡¦", "ðŸ‡»ðŸ‡¨", "ðŸ‡»ðŸ‡ª", "ðŸ‡»ðŸ‡¬", "ðŸ‡»ðŸ‡­", "ðŸ‡»ðŸ‡³", "ðŸ‡»ðŸ‡º",
            "ðŸ‡¼ðŸ‡«", "ðŸ‡¼ðŸ‡¸",
            "ðŸ‡½ðŸ‡°",
            "ðŸ‡¾ðŸ‡ª", "ðŸ‡¾ðŸ‡¹",
            "ðŸ‡¿ðŸ‡¦", "ðŸ‡¿ðŸ‡²", "ðŸ‡¿ðŸ‡¼"
        ]
    ]
    
    var body: some View {
        NavigationView {
            ScrollView {
                VStack(spacing: 20) {
                    TextField("Search Emoji", text: $searchText)
                        .textFieldStyle(RoundedBorderTextFieldStyle())
                        .padding()
                    
                    ForEach(categoryOrder, id: \.self) { category in
                        VStack(alignment: .leading) {
                            Text(category)
                                .font(.headline)
                                .padding(.horizontal)
                            
                            let emojis = categories[category] ?? []
                            let filteredEmojis = emojis.filter { searchText.isEmpty || $0.contains(searchText) }
                            
                            if !filteredEmojis.isEmpty {
                                ScrollView(.horizontal, showsIndicators: false) {
                                    HStack(spacing: 15) {
                                        ForEach(filteredEmojis, id: \.self) { emoji in
                                            Button {
                                                selectedEmoji = emoji
                                                dismiss()
                                            } label: {
                                                Text(emoji)
                                                    .font(.system(size: 40))
                                            }
                                        }
                                    }
                                    .padding(.horizontal)
                                }
                            }
                        }
                    }
                    
                    if !searchText.isEmpty {
                        VStack {
                            Text("Type any emoji in the search field!")
                                .foregroundColor(.secondary)
                            
                            if searchText.containsOnlyEmoji {
                                Button {
                                    selectedEmoji = searchText
                                    dismiss()
                                } label: {
                                    Text("Use '\(searchText)'")
                                        .foregroundColor(.blue)
                                        .padding()
                                        .background(Color.blue.opacity(0.1))
                                        .cornerRadius(8)
                                }
                            }
                        }
                        .padding()
                    }
                }
            }
            .navigationTitle("Select Emoji")
            .navigationBarItems(trailing: Button("Done") { dismiss() })
        }
    }
}

extension String {
    var containsOnlyEmoji: Bool {
        !isEmpty && !contains { !$0.isEmoji }
    }
}

extension Character {
    var isEmoji: Bool {
        guard let scalar = unicodeScalars.first else { return false }
        return scalar.properties.isEmoji && (scalar.value > 0x238C || scalar.value < 0x1F3FB)
    }
} 
